<div id="aggregates" class="container"></div>

<script>
  const container = document.querySelector('#aggregates')

  // cache old accounts to avoid pointless recalculation every render
  let oldAccounts = null

  if (container) {
    window.renderers.push(async function renderAccounts({ accounts }) {
      if (!accounts.length) return

      // can use simple equality check due to how accounts are cached
      if (oldAccounts === accounts) return
      oldAccounts = accounts

      const totals = {
        'Total Earnings': 0,
        'Total Unlocked': 0,
      }

      accounts.forEach(account => {
        totals['Total Earnings'] +=
          account.current_balance - account.starting_balance
        totals['Total Unlocked'] +=
          account.current_balance - account.lockup_info['Locked Amount']
      })

      container.innerHTML = `<p style="text-align: center">${
        Object.entries(totals).map(([label, value]) =>
          `${label}: ${window.utils.formatLargeNum(value)}<br>`
        ).join('')
      }</p>`
    })
  }
</script>
